{"body":"# CanBe [![Build Status](https://secure.travis-ci.org/mstarkman/can_be.png?branch=master)](https://travis-ci.org/mstarkman/can_be) [![Gem Version](https://badge.fury.io/rb/can_be.png)](http://badge.fury.io/rb/can_be) [![Code Climate](https://codeclimate.com/badge.png)](https://codeclimate.com/github/mstarkman/can_be)\r\n\r\nCanBe allows you to track the type of your ActiveRecord model in a consistent simple manner.  With just a little configuration on your part, each type of record can contain different attributes that are specifc to that type of record.  From a data modelling perspective this is preferred over [ActiveRecord STI](http://api.rubyonrails.org/classes/ActiveRecord/Base.html#label-Single+table+inheritance) since you will not have many columns in your database that have null values.  Under the hood, CanBe uses one-to-one [Polymorphic Associations](http://guides.rubyonrails.org/association_basics.html#polymorphic-associations) to accomplish the different attributes per type.\r\n\r\nHere is a blog post that will describe more of the rationale behind the CanBe gem: [http://blog.markstarkman.com/blog/2013/01/09/writing-my-first-rubygem-canbe/](http://blog.markstarkman.com/blog/2013/01/09/writing-my-first-rubygem-canbe/)\r\n\r\n## Versioning\r\n\r\nI will be following [Semantic Versioning](http://semver.org/) as closely as possible.  The `master` branch will be the latest development version and may not match the version of the code you are using. There is a git tag for each released version.  The [CHANGELOG.md](https://github.com/mstarkman/can_be/blob/master/CHANGELOG.md) will contain the correct links to each version.\r\n\r\n## Installation\r\n\r\nAdd this line to your application's Gemfile:\r\n\r\n    gem 'can_be'\r\n\r\nIf you feel like living on the edge, you can add this to your applcation's Gemfile:\r\n\r\n    gem 'can_be', git: \"git://github.com/mstarkman/can_be.git\"\r\n\r\nAnd then execute:\r\n\r\n    $ bundle\r\n\r\n## Database Configuration (via migrations)\r\n\r\nIn its simplest form, you only need to add a string attribute (column) to the model can be different types.  By default, this attribute must be named `can_be_type`.  However, you can have the attribute be named anything that you would like, you just need to tell CanBe what it is.  Indexing this column is your choice.\r\n\r\nExample migration:\r\n\r\n```ruby\r\nclass AddCanBeTypeToAddresses < ActiveRecord::Migration\r\n  def change\r\n    add_column :addresses, :can_be_type, :string\r\n    add_index :addresses, :can_be_type\r\n  end\r\nend\r\n```\r\n\r\n### Details Configuration\r\n\r\nIf you want to store different attributes (columns), there are some more columns that you will need to add to your model, `details_id` and `details_type`.  These fields will be used to store the relationships to the details information.  Indexing these columns is your choice.  Example migration:\r\n\r\n```ruby\r\nclass AddCanBeDetailsToAddresses < ActiveRecord::Migration\r\n  def change\r\n    add_column :addresses, :details_id, :integer\r\n    add_column :addresses, :details_type, :string\r\n    add_index :addresses, [:details_id, :details_type]\r\n  end\r\nend\r\n```\r\n\r\nYou will also need to create the models that will be used to represent the details attributes for each type.  You will need to configure the model to be a details model be calling the `can_be_detail` method in your model.  You do not need to specify a details model for each CanBe type if there are not any extra attributes required for that type.\r\n\r\nIf you planning to use a different `details_name` for the relationship, you will need to change the names of the database columns to have the appropriate `id` and `type` columns. For example, if you wanted to use `:address_details` as the `details_name`, you would do this.\r\n\r\n```ruby\r\nclass AddCanBeDetailsToAddresses < ActiveRecord::Migration\r\n  def change\r\n    add_column :addresses, :address_details_id, :integer\r\n    add_column :addresses, :address_details_type, :string\r\n    add_index :addresses, [:address_details_id, :address_details_type]\r\n  end\r\nend\r\n```\r\n\r\n**NOTE:** Examples of the database migrations can be found in the [`spec/support/schema.rb`](https://github.com/mstarkman/can_be/blob/master/spec/support/schema.rb) file.\r\n\r\n## Model Configuration\r\n\r\nTo add CanBe to your model, you simply need to call the `can_be` method\r\non your model.\r\n\r\n```ruby\r\nclass Address < ActiveRecord::Base\r\n  can_be :home_address, :work_address, :vacation_address\r\nend\r\n```\r\n\r\nThe `can_be` method will take in a list of valid types that will be used by CanBe.  There is an optional last parameter that is a hash of the options.  This is a list of valid options.\r\n\r\n* `:default_type` - Sets the default value for when a new record is instantiated or created (it is the first value in the list by default)\r\n* `:field_name` - Sets the ActiveRecord field name that is to be used (if not specified, CanBe expects a `can_be_type` attribute to be present)\r\n\r\nHere is an example of the options.\r\n\r\n```ruby\r\nclass Person < ActiveRecord::Base\r\n  can_be :male, :female, field_name: :gender, default_type: :female\r\nend\r\n```\r\n\r\nOr you can set the options in a block when calling `can_be`.\r\n\r\n```ruby\r\nclass Person < ActiveRecord::Base\r\n  can_be :male, :female do\r\n    field_name :gender\r\n    default_type :female\r\n  end\r\nend\r\n```\r\n\r\n### Details Model Configuration\r\n\r\nIn order to wire up a model to be a CanBe details model, you will need to call the `can_be_detail` method on that model.\r\n\r\n```ruby\r\nclass HomeAddressDetail < ActiveRecord::Base\r\n  can_be_detail :address\r\nend\r\n```\r\n\r\nThe `can_be_detail` method take in one parameter.  The parameter is the link to the CanBe model.  This must be a symbol that will reference the CanBe model.  In order to create the proper symbol, you can execute the following into your Rails console: `<ModelName>.name.underscore.to_sym`.  Here is an example: `Address.name.underscore.to_sym`.  In the above example, this will be used for the `Address` CanBe model.\r\n\r\nYou will also need to call the `add_details_model` method in the `can_be` block, passing in the CanBe type and a symbol that represets the details model class.\r\n\r\n```ruby\r\nclass Address < ActiveRecord::Base\r\n  can_be :home_address, :work_address, :vacation_address do\r\n    add_details_model :home_address, :home_address_detail\r\n  end\r\nend\r\n```\r\n\r\nIf you are using a different `details_name` for the relationship, you will also need to add the configuration options like this.\r\n\r\n```ruby\r\nclass Address < ActiveRecord::Base\r\n  can_be :home_address, :work_address, :vacation_address do\r\n    add_details_model :home_address, :home_address_detail\r\n    details_name :address_details\r\n  end\r\nend\r\n```\r\n\r\n```ruby\r\nclass HomeAddressDetail < ActiveRecord::Base\r\n  can_be_detail :address, :address_details\r\nend\r\n```\r\n\r\n**NOTE:** Examples of the model configurations can be found in the [`spec/support/models.rb`](https://github.com/mstarkman/can_be/blob/master/spec/support/models.rb) file.\r\n\r\n## Usage\r\n\r\nThe CanBe gem will provide you a lot methods to handle your type processing in an easy and consistent manner.\r\n\r\n### Instantiating New Models\r\n\r\nYou can continue to instantiate your CanBe models by using the `new` method.  When you do, CanBe will ensure that the type of the record is assigned the detault CanBe type for your model.\r\n\r\nThere are also some helper methods put on your model to make it easier to instantiate the type of model that you want.  These methods will take the form of `new_<CanBe type>`.  For example, you can call `Address.new_home_address`.  These methods will take the same parameters as the base `new` method provided by ActiveRecord.\r\n\r\n### Creating New Models\r\n\r\nYou can continue to create your CanBe models by using the `create` method.  When you do, CanBe will ensure that the type of the record is assigned the detault CanBe type for your model.\r\n\r\nThere are also some helper methods put on your model to make it easier to create the type of model that you want.  These methods will take the form of `create_<CanBe type>`.  For example, you can call `Address.create_home_address`.  These methods will take the same parameters as the base `create` method provided by ActiveRecord.\r\n\r\n### Changing CanBe Types\r\n\r\nThere are several ways to change the type of record that you are working with.  You can access the `can_be_type` attribute (or other attribute if you specified the field to be used) and change the value directly.\r\n\r\nThere are also instance methods provided on your model that allow for changing to a specific CanBe type.\r\n\r\nYou can change the type of record and not persist it immediately to the database by calling the appropriate `change_to_<CanBe type>` method.  For example, you can call `Address.new.change_to_work_address` method to change the record to be of CanBe type `:work_address`.\r\n\r\nIf you want to change the type of the record and persist it to the database immediately, you can call the appropriate `change_to_<CanBe type>!` method.  For example, this method call will change the type of record to `:work_address` and persist the change to the database: `Address.create.change_to_work_address!`\r\n\r\nThere is a validator for the CanBe field, that will unsure that the CanBe field is set to one of the CanBe types before persisting the record. \r\n\r\nWhen changing the type of the record via either of these methods, you can pass in a block that will provide you access to the new details record so you can set any data in one method call.\r\n\r\n```ruby\r\nupload.change_to_image_upload do |details|\r\n  details.format = \"jpeg\"\r\nend\r\n```\r\n\r\nNOTE: that when you are changing the type of record the details record will be changed to the correct CanBe details record.  New records will only be persisted to the database when the CanBe model is persisted.  If you change the CanBe model to a type that does not have a corresponding details model, `nil` will be stored for the details.\r\n\r\n### Boolean Evaluation\r\n\r\nWith CanBe, it is easy to determine the type of record that you are working with.  This is accomplished by calling the `<CanBe type>?` on the instance of your model.  For example if you wanted to see if the `Address` instance you are working with, you would call `Address.first.home_address?` and it would return `true` or `false` depending on the CanBe type of the record.\r\n\r\n### Finding Records\r\n\r\nThere are two ways to find specific types of records.  You can use the `find_by_can_be_types` method, which takes in a list of the CanBe types that you want to find.  For example, if you wanted to find all of the home and work addresses you would call `Address.find_by_can_be_types :home_address, :work_address`.\r\n\r\nMethods are also defined on your CanBe model that will find all of the records for a specific CanBe type.  These methods take the form of `<pluralized CanBe type>`.  For example, `Address.home_addresses` would return all of the records with a type of `:home_address`.\r\n\r\n### Accessing the Details\r\n\r\nIf you want to access the details model, you can call the `details` method on your instance and the instance of your model will be returned.  If the type of model that you are using does not have a details model, `nil` will be returned.\r\n\r\nWhen you persist your CanBe model to the database, your details model will automatically be persisted.\r\n\r\nIf you are using a different `details_name`, you will access the details by calling a method of the same name.  For example, if you assigned `:address_details` to the `details_name, then you can access the details by calling the `address_details` method.\r\n\r\n## Contributing\r\n\r\n1. Fork it\r\n2. Create your feature branch (`git checkout -b my-new-feature`)\r\n3. Commit your changes (`git commit -am 'Add some feature'`)\r\n    * Make sure to include the appropriate specs\r\n    * Specs can be run by executing the `rake` command in the terminal\r\n4. Push to the branch (`git push origin my-new-feature`)\r\n5. Create new Pull Request\r\n\r\n## License\r\n\r\nSee [LICENSE.txt](https://github.com/mstarkman/can_be/blob/master/LICENSE.txt).\r\n","tagline":"CanBe allows you to track the type of your ActiveRecord model in a consistent simple manner.  With just a little configuration on your part, each type of record can contain different attributes that are specifc to that type of record.","note":"Don't delete this file! It's used internally to help with page regeneration.","name":"Can be","google":"UA-37228228-1"}